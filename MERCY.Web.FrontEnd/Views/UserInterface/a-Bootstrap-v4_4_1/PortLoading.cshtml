@using MERCY.Web.FrontEnd.Helpers;

@{
    string ui_name               = @"a-Bootstrap-v4_4_1";
    UserInterface userInterface  = new UserInterface(ui_name);
    string ui_Folder_ServerSide  = userInterface.Folder_ServerSide;
    string ui_Folder_Client_Side = userInterface.Folder_ClientSide;

    Layout = ui_Folder_ServerSide + "_Layout.cshtml";
}

<style>
#id_menu_ROMTransfer {
    background-color: #000000;
    border-radius: 4px;
    /*opacity: 0.2;*/
    background: rgba(0,0,0,0.2);
    height: 52px;
    margin: 5px 8px;
}

.filter_title {
    color: #232323;
    font-family: 'OpenSans-SemiBold';
    font-size: 14px;
    font-weight: 700;
    line-height: 17px;
    opacity: 0.8700000047683716;
    text-align: left;
    height: 20px;
}

.select2-selection--single{
    height: 34px !important;
}
.select2-selection__choice {
    height: 34px !important;
}
.select2-selection__arrow{
    height: 32px !important;
}

.table_titlex {
    color: #463191;
    font-family: 'OpenSans-Bold';
    font-size: 14px;
    line-height: 17px;
    text-align: left;
    margin-top:20px !important;
}

.dataTables_info{
    display: none !important;
}

.mercy_box_inner_content{
    min-height: 300px !important;
}
</style>

<link href="@ui_Folder_Client_Side/css/select2.min.css" rel="stylesheet" />
<script src="@ui_Folder_Client_Side/js/select2.min.js"></script>

<div class="col margin_padding_0">
    <div class="row margin_padding_0 mercy_page_Title">
        Port Loading
    </div>
    <div class="row margin_padding_0 mercy_page_Title_2">
        Port Loading
    </div>
    <div class="row margin_padding_0 mercy_box_inner_content" style="min-height:100px !important;">
        <div class="col-12 col-md-auto margin_padding_0" style="padding: 15px 0px 0px 15px !important;">
            <div style="width: 200px;">
                <div style="width:100%" class="filter_title">Company</div>
                <div style="width:100%;padding:10px 0px !important;">
                    <select id="ddl_Company" class="shadow-none custom-select d-block w-100 mercy_select mercy_input_text" style="width:100%;"></select>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-auto margin_padding_0" style="padding: 15px 0px 0px 15px !important;">
            <div style="width: 160px;">
                <div style="width:100%" class="filter_title">Period (Month & Year)</div>
                <div style="width:100%;padding:10px 0px !important;">
                    <div class="input-group date">
                        <input id="txtPeriod" class="mercy_select mercy_input_text mercy_date" style="width:100% !important;" data-date-format="dd-M-yyyy" placeholder="dd-M-yyyy" />
                        <div class="input-group-prepend">
                            <span class="input-group-text mercy_date_icon"> </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-md margin_padding_0">
            <div class="row margin_padding_0">
            </div>
        </div>
    </div>
    <div class="row margin_padding_0 mercy_box_inner_content">
        <div class="col margin_padding_0" style="padding: 0px 20px !important;">
            <div class="row margin_padding_0" style="margin-bottom:20px !important;">
                <div class="table_titlex">BY BUDGET</div>
            </div>
            <div class="row margin_padding_0">
                <table id="mercyTable_Budget" class="display nowrap table table-striped table-hover mercy_table mercy_table_header" style="width:100%;">
                    <thead>
                        <tr>
                            <th>RecordId</th>
                            <th>No_Line</th>
                            <th><div style="color:white;text-align: center !important;">Action</div></th>
                            <th>No</th>
                            <th>Product</th>
                            <th>Tonnage</th>
                            <th>CV</th>
                            <th>TS</th>
                            <th>ASH</th>
                            <th>IM</th>
                            <th>TM</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    <div class="row margin_padding_0 mercy_box_inner_content">
        <div class="col margin_padding_0" style="padding: 0px 20px !important;">
            <div class="row margin_padding_0" style="margin-bottom:20px !important;">
                <div class="table_titlex">BY OUTLOOK</div>
            </div>
            <div class="row margin_padding_0">
                <table id="mercyTable_Outlook" class="display nowrap table table-striped table-hover mercy_table mercy_table_header" style="width:100%;">
                    <thead>
                        <tr>
                            <th>RecordId</th>
                            <th>No_Line</th>
                            <th><div style="color:white;text-align: center !important;">Action</div></th>
                            <th>No</th>
                            <th>Product</th>
                            <th>Tonnage</th>
                            <th>CV</th>
                            <th>TS</th>
                            <th>ASH</th>
                            <th>IM</th>
                            <th>TM</th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">

// Flag
var is_still_AJAX_dataList = false;
var ignore_trigger_change_ddl_Company = false;

// DataGrid
var obj_html_Table_Budget;
var obj_html_Company;

var current_Record;

// row
var isNew_Budget = false;
var is_Mode_Editor_Budget = false;
var lineNumber_Data_Budget = 0;
var object_Created_Count_Budget = 0;
var object_id_additional_Budget = ''; // pattern is: '_' + object_Created_Count_Budget + '_' + lineNumber_Data_Budget;
var object_id_Created_Budget = [];
var object_id_Deleted_Budget = [];

var isNew_Outlook = false;
var is_Mode_Editor_Outlook = false;
var lineNumber_Data_Outlook = 0;
var object_Created_Count_Outlook = 0;
var object_id_additional_Outlook = ''; // pattern is: '_' + object_Created_Count_Outlook + '_' + lineNumber_Data_Outlook;
var object_id_Created_Outlook = [];
var object_id_Deleted_Outlook = [];

$(document).ready(function (){
    $(document).attr('title', 'Port Loading : Mercy');

    $(window).resize(function (){
        // Resize Table: because the Window is Resized
        resize_Table();
    });

    $("#txtPeriod").datepicker({
        format: 'mm-yyyy',
        autoclose: true,
        startView: "months",
        minViewMode: "months"
    }).on('changeDate', function (selected) {
        Populate_DataGrid();
    });
    $('#txtPeriod').datepicker('update', new Date());
    
    Create_ddl_Company();

    Load_Page_List();
});

function Clear_DataGrid_(p_id){
    try {
        $('#' + p_id).DataTable().clear().destroy();
        //$('#'+p_id).DataTable().destroy();
    }catch(err){}
    
    try {
        $('#'+p_id+' tbody').empty();
    }catch(err){}
}

function Clear_DataGrid(){
    Create_Table_Budget();
    Create_Table_Outlook();
}

function Create_Table_Budget(){
    Clear_DataGrid_('mercyTable_Budget');

    try {
        obj_html_Table_Budget = $('#mercyTable_Budget').DataTable({
            "bAutoWidth": false
            , "bFilter": false
            , "dom": '<"top">rt<"bottom"iflp><"clear">'
            , "scrollX": true
            , "scrollY": false //"200px"
            //, "scrollCollapse": true
            , "paging": false
            //, "ordering": false
            , "columns": [
                { "data": "RecordId", "name": "RecordId", "autoWidth": true }
                , {
                    render: function (data, type, full, meta){
                        return lineNumber_Data_Budget;
                    }
                    , visible: false
                }
                , {
                    render: function (data, type, full, meta) {
                        return '<div style="width:50px !important;">'+
                                '<input type="hidden" id="data_RecordId' + object_id_additional_Budget + '" value="' + full.RecordId + '"/>' +
                                '<input type="hidden" id="data_ProductId' + object_id_additional_Budget + '" value="' + full.ProductId + '"/>' +
                                '<input type="hidden" id="data_Product' + object_id_additional_Budget + '" value="' + full.ProductName + '"/>' +
                                '<i id="data_link_Edit' + object_id_additional_Budget + '" onclick="javascript:processLink_Edit_Budget(this)" class="fa fa-edit" style="cursor: pointer;font-size: 20px;color:white;' + (isNew_Budget?'display:none;':(permission.Is_Edit?'':'display:none;')) + '" title="Edit"></i>' +
                                '<i id="data_link_Delete' + object_id_additional_Budget + '" onclick="javascript:processLink_Delete_Budget(this)" class="fa fa-trash" style="cursor: pointer;font-size: 20px;color:white;margin-left:10px;' + (isNew_Budget?'display:none;':(permission.Is_Delete?'':'display:none;')) + '" title="Delete"></i>' +
                                '<i id="data_link_Save' + object_id_additional_Budget + '" onclick="javascript:processLink_Save_Budget(this)" class="fa fa-save" style="cursor: pointer;font-size: 20px;color:white;' + (isNew_Budget?'':'display:none;') + '" title="Save"></i>' +
                                '<i id="data_link_Cancel' + object_id_additional_Budget + '" onclick="javascript:processLink_Cancel_Budget(this)" class="fa fa-times" style="cursor: pointer;font-size: 20px;color:white;margin-left:10px;' + (isNew_Budget?'':'display:none;') + '" title="Cancel"></i>'
                                '</div>'
                                ;
                    }
                    , className: "mercy_action_icon"
                    , orderable: false
                    , width: "50px"
                }
                , {
                    "render": function (data, type, full, meta){
                        return (isNew_Budget?'':lineNumber_Data_Budget.toString() + '.');
                    }
                    , className: "mercy_text_right"
                    , orderable: false
                    , width: "20px"
                }
                , { "data": "ProductName", "name": "ProductName", width: "140px", orderable: false }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_Tonnage_label' + object_id_additional_Budget + '">' + full.Tonnage + '</span>' +
                               '<input type="text" id="data_Tonnage_txt' + object_id_additional_Budget + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Budget?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_CV_label' + object_id_additional_Budget + '">' + full.CV + '</span>' +
                               '<input type="text" id="data_CV_txt' + object_id_additional_Budget + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Budget?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_TS_label' + object_id_additional_Budget + '">' + full.TS + '</span>' +
                               '<input type="text" id="data_TS_txt' + object_id_additional_Budget + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Budget?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_ASH_label' + object_id_additional_Budget + '">' + full.ASH + '</span>' +
                               '<input type="text" id="data_ASH_txt' + object_id_additional_Budget + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Budget?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_IM_label' + object_id_additional_Budget + '">' + full.IM + '</span>' +
                               '<input type="text" id="data_IM_txt' + object_id_additional_Budget + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Budget?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_TM_label' + object_id_additional_Budget + '">' + full.TM + '</span>' +
                               '<input type="text" id="data_TM_txt' + object_id_additional_Budget + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Budget?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
            ]
            , "columnDefs": [
                {
                    "targets": [0],
                    "visible": false,
                    "searchable": false
                }
            ]
            //, "order": [[3, 'desc'], [4, 'asc']]
            , "order": [[1, 'asc']]
        });

        obj_html_Table_Budget.on('draw', function () {});
        
        // Resize Table: because this DataTable is newly created
        resize_Table();
    }catch(err){}
}

function Populate_DataGrid(){
    if (is_still_AJAX_dataList) return;
    
    is_still_AJAX_dataList = true;
    
    Clear_DataGrid();
    
    // reset
    lineNumber_Data_Budget = 0;
    object_id_Created_Budget = [];
    object_id_Deleted_Budget = [];

    lineNumber_Data_Outlook = 0;
    object_id_Created_Outlook = [];
    object_id_Deleted_Outlook = [];
    
    var period = $("#txtPeriod").data('datepicker').getFormattedDate('yyyy-mm');

    // data from AJAX
    $.ajax({
        'async': false
        ,url: api_Request + '/Api/PortLoading'
        , type: 'POST'
        , data: {u_menu:get_user_menu, u_relation:get_user_relation, company:$('#ddl_Company').val(), period:period}
        , dataType: "json"
        , beforeSend: function (request){
            // Set "Token" in HTTP_Header
            request.setRequestHeader(MERCY_Token, MERCY_Token_Value);
        }
        , cache: false
        , success: function (data){
            is_still_AJAX_dataList = false;
            
            if ( ! $.trim(data)) {
                // empty data
                return;
            }
            
            if ( ! data.Success){
                alert(data.Message);
                
                window.location = '/NoAccess';
                return;
            }
            
            // we need "Permission" information
            permission = data.Permission;
            
            // Special Purpose, getting information of CurrentUser
            if (get_user_menu == '1'){
                after_GetUserInfo(data.User);
                uInfo = data.User;
                
                current_Record = data;

                Clear_DataGrid();

                Populate_Data_ddl_Company();
            }
            
            // reset
            get_user_menu = '0';
            get_user_relation = '0';
            
            // make it "Intuitive"
            Display_Buttons();
            Display_Buttons_InLine_Editing();
            
            // assign Data to Table
            /*try {
                obj_html_Table_Budget.rows.add(data.Items); // add to DataTable instance
                obj_html_Table_Budget.draw(); // always redraw
            }catch(err){}*/
            
            data.Items.forEach(
                function (item){
                    if (item.Type == 'budget'){
                        isNew_Budget = false;
                        object_Created_Count_Budget++;
                        lineNumber_Data_Budget++;
                        object_id_additional_Budget = '_budget_' + object_Created_Count_Budget.toString() + '_' + lineNumber_Data_Budget.toString();
                        
                        // save to Array
                        object_id_Created_Budget.push(object_id_additional_Budget);
                        
                        // add to Table
                        obj_html_Table_Budget.row.add(item).draw(false);
                    }
                }
            );
            
            data.Items.forEach(
                function (item){
                    if (item.Type == 'outlook'){
                        isNew_Outlook = false;
                        object_Created_Count_Outlook++;
                        lineNumber_Data_Outlook++;
                        object_id_additional_Outlook = '_outlook_' + object_Created_Count_Outlook.toString() + '_' + lineNumber_Data_Outlook.toString();
                        
                        // save to Array
                        object_id_Created_Outlook.push(object_id_additional_Outlook);
                        
                        // add to Table
                        obj_html_Table_Outlook.row.add(item).draw(false);
                    }
                }
            );

            // Resize Table: because this DataTable is filled with new Data
            resize_Table();
        },
        error: function (error){
            is_still_AJAX_dataList = false;
            
            $(this).remove();
        }
    });
}

function processLink_Edit_Budget(p_this){
    // -- Global Flag
    if (is_Mode_Editor_Budget) return;
    
    // just reminder about Pattern
    // pattern is: {LABEL}'_' + object_Created_Count_Budget + '_' + lineNumber_Data_Budget;
    
    try {
        var target_id = p_this.id;
        var target_id_additional = target_id.replace('data_link_Edit', '');
        
        $('#data_link_Edit' + target_id_additional).hide();
        $('#data_link_Delete' + target_id_additional).hide();
        $('#data_link_Save' + target_id_additional).show();
        $('#data_link_Cancel' + target_id_additional).show();
        
        // Firstly, copy data
        $('#data_Tonnage_txt' + target_id_additional).val($('#data_Tonnage_label' + target_id_additional).text());
        $('#data_CV_txt' + target_id_additional).val($('#data_CV_label' + target_id_additional).text());
        $('#data_TS_txt' + target_id_additional).val($('#data_TS_label' + target_id_additional).text());
        $('#data_ASH_txt' + target_id_additional).val($('#data_ASH_label' + target_id_additional).text());
        $('#data_IM_txt' + target_id_additional).val($('#data_IM_label' + target_id_additional).text());
        $('#data_TM_txt' + target_id_additional).val($('#data_TM_label' + target_id_additional).text());
        
        // Secondly, set Show/Hide
        $('#data_Tonnage_label' + target_id_additional).hide();
        $('#data_Tonnage_txt' + target_id_additional).show();
        $('#data_CV_label' + target_id_additional).hide();
        $('#data_CV_txt' + target_id_additional).show();
        $('#data_TS_label' + target_id_additional).hide();
        $('#data_TS_txt' + target_id_additional).show();
        $('#data_ASH_label' + target_id_additional).hide();
        $('#data_ASH_txt' + target_id_additional).show();
        $('#data_IM_label' + target_id_additional).hide();
        $('#data_IM_txt' + target_id_additional).show();
        $('#data_TM_label' + target_id_additional).hide();
        $('#data_TM_txt' + target_id_additional).show();
    }catch(err){}
    
    is_Mode_Editor_Budget = true;
    $('#btnAdd').addClass('mercy_button_Add_disable');
}

function processLink_Cancel_Budget(p_this){
    // just reminder about Pattern
    // pattern is: {LABEL}'_' + object_Created_Count_Budget + '_' + lineNumber_Data_Budget;
    
    var target_id = p_this.id;
    var target_id_additional = target_id.replace('data_link_Cancel', '');
        
    try {
        $('#data_link_Edit' + target_id_additional).show();
        $('#data_link_Delete' + target_id_additional).show();
        $('#data_link_Save' + target_id_additional).hide();
        $('#data_link_Cancel' + target_id_additional).hide();
        
        $('#data_Tonnage_label' + target_id_additional).show();
        $('#data_Tonnage_txt' + target_id_additional).hide();

        $('#data_CV_label' + target_id_additional).show();
        $('#data_CV_txt' + target_id_additional).hide();
        $('#data_TS_label' + target_id_additional).show();
        $('#data_TS_txt' + target_id_additional).hide();
        $('#data_ASH_label' + target_id_additional).show();
        $('#data_ASH_txt' + target_id_additional).hide();
        $('#data_IM_label' + target_id_additional).show();
        $('#data_IM_txt' + target_id_additional).hide();
        $('#data_TM_label' + target_id_additional).show();
        $('#data_TM_txt' + target_id_additional).hide();
    }catch(err){}
    
    isNew_Budget = false;
    is_Mode_Editor_Budget = false;
    $('#btnAdd').removeClass('mercy_button_Add_disable');
    
    var recordId = $('#data_RecordId' + target_id_additional).val();
    if (recordId == '-1'){
        action = 'Create';
    }else{
        action = 'Edit';
        return;
    }
    
    return;
    
    try {
        var lineFound = -1;
        var line = 0;
        $.each(object_id_Created_Budget, function( i, val ){
            line++;
            if (val == target_id_additional)
            {
                lineFound = line;
            }
        });
        
        if (lineFound >= 0){
            var $rows = $("#mercyTable_Budget tr");
            //lineFound--;
            $rows.eq(lineFound).hide();
        }
    }catch(err){}
}

function processLink_Save_Budget(p_this){
    var action = 'Create';
    
    var target_id = p_this.id;
    var target_id_additional = target_id.replace('data_link_Save', '');
    
    if ( ! Is_Valid_Numeric('#data_Tonnage_txt' + target_id_additional)){
        alert('Data Ton is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_CV_txt' + target_id_additional)){
        alert('Data CV is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_TS_txt' + target_id_additional)){
        alert('Data TS is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_ASH_txt' + target_id_additional)){
        alert('Data ASH is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_IM_txt' + target_id_additional)){
        alert('Data IM is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_TM_txt' + target_id_additional)){
        alert('Data TM is not valid (should be numeric value)');
        return;
    }
    
    var recordId = $('#data_RecordId' + target_id_additional).val();
    
    // data to AJAX
    $.ajax({
        url: api_Request + '/Api/PortLoading/Edit'
        , type: 'POST'
        , data: {'.id':recordId
                , 'Type':'budget'
                , 'company':$('#ddl_Company').val()
                , 'period':$("#txtPeriod").data('datepicker').getFormattedDate('yyyy-mm')
                , 'ProductId':$('#data_ProductId' + target_id_additional).val()
                , 'Product':$('#data_Product' + target_id_additional).val()
                , 'Tonnage':$('#data_Tonnage_txt' + target_id_additional).val()
                , 'CV':$('#data_CV_txt' + target_id_additional).val()
                , 'TS':$('#data_TS_txt' + target_id_additional).val()
                , 'ASH':$('#data_ASH_txt' + target_id_additional).val()
                , 'IM':$('#data_IM_txt' + target_id_additional).val()
                , 'TM':$('#data_TM_txt' + target_id_additional).val()
        }
        , dataType: "json"
        , beforeSend: function (request){
            // Set "Token" in HTTP_Header
            request.setRequestHeader(MERCY_Token, MERCY_Token_Value);
        }
        , cache: false
        , success: function (data){
            if ( ! $.trim(data)){
                // empty data
                alert('empty data');
                return;
            }
            
            if ( ! data.Success){
                alert(data.Message);
                return;
            }
             
            isNew_Budget = false;
            is_Mode_Editor_Budget = false;
            
            $('#btnAdd').removeClass('mercy_button_Add_disable');

            alert('Success');
            
            Populate_DataGrid();
        },
        error: function (error){
            $(this).remove();
        }
    });
}

function processLink_Delete_Budget(p_this){
    alert('There is no action for Delete');
}

function Create_ddl_Company() {
    if (obj_html_Company != null) return;

    obj_html_Company = $('#ddl_Company').select2({
        placeholder: 'Select Company'
        , tags: false
        , multiple: false
        //, tokenSeparators: [',', ' ']
        //, minimumInputLength: 3
        , minimumResultsForSearch: -1
    });

    $('#ddl_Company').change(function (e) {
        OnChange_ddl_Company();
    });
}

function OnChange_ddl_Company() {
    
    if (ignore_trigger_change_ddl_Company) return;
    
    Populate_DataGrid();
}

function Populate_Data_ddl_Company() {
    try {
        var option;
        var first = '';

        current_Record.Companies.forEach(
            function (item) {
                // create the option and append to Select2
                option = new Option(item.id, item.text, true, true);
                obj_html_Company.append(option);//.trigger('change');

                if (first == '') first = item.id;
            }
        );

        // Inisial value for "Company"
        ignore_trigger_change_ddl_Company = true;
        $('#ddl_Company').val(first).trigger('change');
        ignore_trigger_change_ddl_Company = false;
    }catch(err){}
}

function Is_Valid_Numeric(p_id){
    var val_x = $(p_id).val().replace(',', '');
    
    if ($.isNumeric(val_x)){
        return true;
    }
    
    return false;
}

function Create_Table_Outlook(){
    Clear_DataGrid_('mercyTable_Outlook');

    try {
        obj_html_Table_Outlook = $('#mercyTable_Outlook').DataTable({
            "bAutoWidth": false
            , "bFilter": false
            , "dom": '<"top">rt<"bottom"iflp><"clear">'
            , "scrollX": true
            , "scrollY": false //"200px"
            //, "scrollCollapse": true
            , "paging": false
            //, "ordering": false
            , "columns": [
                { "data": "RecordId", "name": "RecordId", "autoWidth": true }
                , {
                    render: function (data, type, full, meta){
                        return lineNumber_Data_Outlook;
                    }
                    , visible: false
                }
                , {
                    render: function (data, type, full, meta) {
                        return '<div style="width:50px !important;">'+
                                '<input type="hidden" id="data_RecordId' + object_id_additional_Outlook + '" value="' + full.RecordId + '"/>' +
                                '<input type="hidden" id="data_ProductId' + object_id_additional_Outlook + '" value="' + full.ProductId + '"/>' +
                                '<input type="hidden" id="data_Product' + object_id_additional_Outlook + '" value="' + full.ProductName + '"/>' +
                                '<i id="data_link_Edit' + object_id_additional_Outlook + '" onclick="javascript:processLink_Edit_Outlook(this)" class="fa fa-edit" style="cursor: pointer;font-size: 20px;color:white;' + (isNew_Outlook?'display:none;':(permission.Is_Edit?'':'display:none;')) + '" title="Edit"></i>' +
                                '<i id="data_link_Delete' + object_id_additional_Outlook + '" onclick="javascript:processLink_Delete_Outlook(this)" class="fa fa-trash" style="cursor: pointer;font-size: 20px;color:white;margin-left:10px;' + (isNew_Outlook?'display:none;':(permission.Is_Delete?'':'display:none;')) + '" title="Delete"></i>' +
                                '<i id="data_link_Save' + object_id_additional_Outlook + '" onclick="javascript:processLink_Save_Outlook(this)" class="fa fa-save" style="cursor: pointer;font-size: 20px;color:white;' + (isNew_Outlook?'':'display:none;') + '" title="Save"></i>' +
                                '<i id="data_link_Cancel' + object_id_additional_Outlook + '" onclick="javascript:processLink_Cancel_Outlook(this)" class="fa fa-times" style="cursor: pointer;font-size: 20px;color:white;margin-left:10px;' + (isNew_Outlook?'':'display:none;') + '" title="Cancel"></i>'
                                '</div>'
                                ;
                    }
                    , className: "mercy_action_icon"
                    , orderable: false
                    , width: "50px"
                }
                , {
                    "render": function (data, type, full, meta){
                        return (isNew_Outlook?'':lineNumber_Data_Outlook.toString() + '.');
                    }
                    , className: "mercy_text_right"
                    , orderable: false
                    , width: "20px"
                }
                , { "data": "ProductName", "name": "ProductName", width: "140px", orderable: false }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_Tonnage_label' + object_id_additional_Outlook + '">' + full.Tonnage + '</span>' +
                               '<input type="text" id="data_Tonnage_txt' + object_id_additional_Outlook + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Outlook?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_CV_label' + object_id_additional_Outlook + '">' + full.CV + '</span>' +
                               '<input type="text" id="data_CV_txt' + object_id_additional_Outlook + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Outlook?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_TS_label' + object_id_additional_Outlook + '">' + full.TS + '</span>' +
                               '<input type="text" id="data_TS_txt' + object_id_additional_Outlook + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Outlook?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_ASH_label' + object_id_additional_Outlook + '">' + full.ASH + '</span>' +
                               '<input type="text" id="data_ASH_txt' + object_id_additional_Outlook + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Outlook?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_IM_label' + object_id_additional_Outlook + '">' + full.IM + '</span>' +
                               '<input type="text" id="data_IM_txt' + object_id_additional_Outlook + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Outlook?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
                , {
                    "render": function (data, type, full, meta){
                        return '<span id="data_TM_label' + object_id_additional_Outlook + '">' + full.TM + '</span>' +
                               '<input type="text" id="data_TM_txt' + object_id_additional_Outlook + '" class="shadow-none" value="" ' + ' style="width:80px;' + (isNew_Outlook?'':'display:none;') + '"/>'
                               ;
                    }
                    , orderable: false
                }
            ]
            , "columnDefs": [
                {
                    "targets": [0],
                    "visible": false,
                    "searchable": false
                }
            ]
            //, "order": [[3, 'desc'], [4, 'asc']]
            , "order": [[1, 'asc']]
        });

        obj_html_Table_Outlook.on('draw', function () {});
        
        // Resize Table: because this DataTable is newly created
        resize_Table();
    }catch(err){}
}

function processLink_Edit_Outlook(p_this){
    // -- Global Flag
    if (is_Mode_Editor_Outlook) return;
    
    // just reminder about Pattern
    // pattern is: {LABEL}'_' + object_Created_Count_Outlook + '_' + lineNumber_Data_Outlook;
    
    try {
        var target_id = p_this.id;
        var target_id_additional = target_id.replace('data_link_Edit', '');
        
        $('#data_link_Edit' + target_id_additional).hide();
        $('#data_link_Delete' + target_id_additional).hide();
        $('#data_link_Save' + target_id_additional).show();
        $('#data_link_Cancel' + target_id_additional).show();
        
        // Firstly, copy data
        $('#data_Tonnage_txt' + target_id_additional).val($('#data_Tonnage_label' + target_id_additional).text());
        $('#data_CV_txt' + target_id_additional).val($('#data_CV_label' + target_id_additional).text());
        $('#data_TS_txt' + target_id_additional).val($('#data_TS_label' + target_id_additional).text());
        $('#data_ASH_txt' + target_id_additional).val($('#data_ASH_label' + target_id_additional).text());
        $('#data_IM_txt' + target_id_additional).val($('#data_IM_label' + target_id_additional).text());
        $('#data_TM_txt' + target_id_additional).val($('#data_TM_label' + target_id_additional).text());
        
        // Secondly, set Show/Hide
        $('#data_Tonnage_label' + target_id_additional).hide();
        $('#data_Tonnage_txt' + target_id_additional).show();
        $('#data_CV_label' + target_id_additional).hide();
        $('#data_CV_txt' + target_id_additional).show();
        $('#data_TS_label' + target_id_additional).hide();
        $('#data_TS_txt' + target_id_additional).show();
        $('#data_ASH_label' + target_id_additional).hide();
        $('#data_ASH_txt' + target_id_additional).show();
        $('#data_IM_label' + target_id_additional).hide();
        $('#data_IM_txt' + target_id_additional).show();
        $('#data_TM_label' + target_id_additional).hide();
        $('#data_TM_txt' + target_id_additional).show();
    }catch(err){}
    
    is_Mode_Editor_Outlook = true;
    $('#btnAdd').addClass('mercy_button_Add_disable');
}

function processLink_Cancel_Outlook(p_this){
    // just reminder about Pattern
    // pattern is: {LABEL}'_' + object_Created_Count_Outlook + '_' + lineNumber_Data_Outlook;
    
    var target_id = p_this.id;
    var target_id_additional = target_id.replace('data_link_Cancel', '');
        
    try {
        $('#data_link_Edit' + target_id_additional).show();
        $('#data_link_Delete' + target_id_additional).show();
        $('#data_link_Save' + target_id_additional).hide();
        $('#data_link_Cancel' + target_id_additional).hide();
        
        $('#data_Tonnage_label' + target_id_additional).show();
        $('#data_Tonnage_txt' + target_id_additional).hide();

        $('#data_CV_label' + target_id_additional).show();
        $('#data_CV_txt' + target_id_additional).hide();
        $('#data_TS_label' + target_id_additional).show();
        $('#data_TS_txt' + target_id_additional).hide();
        $('#data_ASH_label' + target_id_additional).show();
        $('#data_ASH_txt' + target_id_additional).hide();
        $('#data_IM_label' + target_id_additional).show();
        $('#data_IM_txt' + target_id_additional).hide();
        $('#data_TM_label' + target_id_additional).show();
        $('#data_TM_txt' + target_id_additional).hide();
    }catch(err){}
    
    isNew_Outlook = false;
    is_Mode_Editor_Outlook = false;
    $('#btnAdd').removeClass('mercy_button_Add_disable');
    
    var recordId = $('#data_RecordId' + target_id_additional).val();
    if (recordId == '-1'){
        action = 'Create';
    }else{
        action = 'Edit';
        return;
    }
    
    return;
    
    try {
        var lineFound = -1;
        var line = 0;
        $.each(object_id_Created_Outlook, function( i, val ){
            line++;
            if (val == target_id_additional)
            {
                lineFound = line;
            }
        });
        
        if (lineFound >= 0){
            var $rows = $("#mercyTable_Outlook tr");
            //lineFound--;
            $rows.eq(lineFound).hide();
        }
    }catch(err){}
}

function processLink_Save_Outlook(p_this){
    var action = 'Create';
    
    var target_id = p_this.id;
    var target_id_additional = target_id.replace('data_link_Save', '');
    
    if ( ! Is_Valid_Numeric('#data_Tonnage_txt' + target_id_additional)){
        alert('Data Ton is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_CV_txt' + target_id_additional)){
        alert('Data CV is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_TS_txt' + target_id_additional)){
        alert('Data TS is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_ASH_txt' + target_id_additional)){
        alert('Data ASH is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_IM_txt' + target_id_additional)){
        alert('Data IM is not valid (should be numeric value)');
        return;
    }
    
    if ( ! Is_Valid_Numeric('#data_TM_txt' + target_id_additional)){
        alert('Data TM is not valid (should be numeric value)');
        return;
    }
    
    var recordId = $('#data_RecordId' + target_id_additional).val();
    
    // data to AJAX
    $.ajax({
        url: api_Request + '/Api/PortLoading/Edit'
        , type: 'POST'
        , data: {'.id':recordId
                , 'Type':'outlook'
                , 'company':$('#ddl_Company').val()
                , 'period':$("#txtPeriod").data('datepicker').getFormattedDate('yyyy-mm')
                , 'ProductId':$('#data_ProductId' + target_id_additional).val()
                , 'Product':$('#data_Product' + target_id_additional).val()
                , 'Tonnage':$('#data_Tonnage_txt' + target_id_additional).val()
                , 'CV':$('#data_CV_txt' + target_id_additional).val()
                , 'TS':$('#data_TS_txt' + target_id_additional).val()
                , 'ASH':$('#data_ASH_txt' + target_id_additional).val()
                , 'IM':$('#data_IM_txt' + target_id_additional).val()
                , 'TM':$('#data_TM_txt' + target_id_additional).val()
        }
        , dataType: "json"
        , beforeSend: function (request){
            // Set "Token" in HTTP_Header
            request.setRequestHeader(MERCY_Token, MERCY_Token_Value);
        }
        , cache: false
        , success: function (data){
            if ( ! $.trim(data)){
                // empty data
                alert('empty data');
                return;
            }
            
            if ( ! data.Success){
                alert(data.Message);
                return;
            }
             
            isNew_Outlook = false;
            is_Mode_Editor_Outlook = false;
            
            $('#btnAdd').removeClass('mercy_button_Add_disable');

            alert('Success');
            
            Populate_DataGrid();
        },
        error: function (error){
            $(this).remove();
        }
    });
}

function processLink_Delete_Outlook(p_this){
    alert('There is no action for Delete');
}

</script>
